#!/bin/bash

# Example script to run the pipline and pass parameters

echo -n "Enter name for project: "
read projectname

if oc projects 2>&1 | grep ${projectname}
then
  echo -n "That project already exists, do you wish to use it (y/n)? "
  read answer
  if [[ $answer == n* ]]
  then
    exit 1
  fi
fi

if ! oc new-project ${projectname} >/dev/null 2>&1
then
  oc project ${projectname}
fi

oc apply -f Jenkins-Pipelines/DB-APP/jenkins-pipeline.yaml

# Check if Jenkins already there
if ! oc get pods | grep jenkins
then
  # Give Jenkins time to start
  counter=0
  echo -n "Waiting for Jenkins: "
  while (( counter <= 20 ))
  do
    echo -n "."
    sleep 15
    ((counter=counter+1))
  done
fi

oc start-build pipeline -e PROJECTNAME=${projectname} \
-e GITREPOAPI=https://bitbucket.org/stevshil/hello-world-spring-boot.git \
-e GITREPODB=https://bitbucket.org/stevshil/dockerdb.git \
-e BUILDDB="true"
