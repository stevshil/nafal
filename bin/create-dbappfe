#!/bin/bash

# Example script to run the pipline and pass parameters

echo -n "Enter name for project: "
read projectname

if oc projects >/dev/null 2>&1 | grep ${projectname}
then
  echo "That project already exists, please choose another."
  exit 1
fi

if ! oc new-project ${projectname} >/dev/null 2>&1
then
  echo "Unable to create new project, please check that you are logged on to OpenShift"
  exit 2
fi

oc apply -f Jenkins-Pipelines/DB-APP-FE/jenkins-pipeline.yaml

# Give Jenkins time to start
counter=0
echo -n "Waiting for Jenkins: "
while (( counter <= 20 ))
do
  echo -n "."
  sleep 15
  ((counter=counter+1))
done

oc start-build pipeline -e PROJECTNAME=${projectname} \
-e GITREPOAPI=https://bitbucket.org/stevshil/hello-world-spring-boot.git \
-e GITREPOFE=https://bitbucket.org/stevshil/openshift-angular-app.git \
-e GITREPODB=https://bitbucket.org/stevshil/dockerdb.git \
-e BUILDDB="true"
